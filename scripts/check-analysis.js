const {Pool}=require('pg');const fs=require('fs');const p=fs.readFileSync('.env.local','utf8');p.split('\n').forEach(l=>{const m=l.match(/^([^=]+)=(.*)$/);if(m&&!process.env[m[1].trim()])process.env[m[1].trim()]=m[2].trim()});const pool=new Pool({connectionString:process.env.DATABASE_URL,ssl:{rejectUnauthorized:false}});pool.query('SELECT COUNT(*) as total, COUNT(sentiment_score) as analyzed FROM messages').then(r=>{console.log('\nüìä Email Analysis Status:\n');console.log('Total messages in database: '+r.rows[0].total);console.log('Analyzed with sentiment: '+r.rows[0].analyzed);console.log('Unanalyzed: '+(r.rows[0].total-r.rows[0].analyzed)+'\n');if(parseInt(r.rows[0].analyzed)>0){pool.query('SELECT sentiment_score, snippet FROM messages WHERE sentiment_score IS NOT NULL ORDER BY internal_date DESC LIMIT 3').then(r2=>{console.log('Sample analyzed messages:\n');r2.rows.forEach((m,i)=>{const score=parseFloat(m.sentiment_score);const pct=Math.round((score+1)*50);console.log((i+1)+'. Sentiment: '+pct+'% positive (raw: '+score.toFixed(2)+')');console.log('   Snippet: "'+m.snippet.substring(0,70)+'..."\n')});pool.end()})}else{console.log('‚ö†Ô∏è  No messages have been analyzed yet!');console.log('\nTo analyze your emails:');console.log('  pnpm run analyze:messages\n');pool.end()}})
